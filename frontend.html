<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Legal Aid Chat - Test UI + Voice</title>

<!-- LiveKit Browser SDK -->
<script type="module">
    import { VoiceAssistant } from "https://unpkg.com/@livekit/agents-browser@latest/dist/index.js";

    window.startVoiceAssistant = async function () {
        const serverUrl = "wss://legal-aid-assistant-3k5z25gv.livekit.cloud";   // TODO: replace
        const token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NjMzNjA5NjYsImlkZW50aXR5IjoiYWRtaW4iLCJpc3MiOiJBUElZZEJReVhvclpTVWMiLCJuYmYiOjE3NjMzNjAwNjYsInN1YiI6ImFkbWluIiwidmlkZW8iOnsiY2FuUHVibGlzaCI6dHJ1ZSwiY2FuUHVibGlzaERhdGEiOnRydWUsImNhblN1YnNjcmliZSI6dHJ1ZSwicm9vbSI6ImFkbWluIiwicm9vbUpvaW4iOnRydWV9fQ.em25l5XfyT9aaR7d-t7T0PaPbu8q62N7_XEsfN63js0";           // TODO: replace

        const container = document.getElementById("voice-container");
        container.innerHTML = "<p>üé§ Initializing voice assistant...</p>";

        try {
            const assistant = await VoiceAssistant.connect({
                url: serverUrl,
                token: token,
                autoStart: true,
                vad: true,      // voice activity detection
            });

            container.innerHTML = "";
            assistant.mount(container);

            console.log("Voice Assistant Ready!");
        } catch (err) {
            container.innerHTML = "<p style='color:red;'>Error starting voice assistant.</p>";
            console.error(err);
        }
    }
</script>

<style>
    body {
        font-family: Arial, sans-serif;
        background: #f2f2f2;
        padding: 30px;
    }
    #chat-box {
        width: 100%;
        max-width: 600px;
        background: #fff;
        padding: 20px;
        border-radius: 10px;
        margin: auto;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    textarea {
        width: 100%;
        height: 70px;
        border-radius: 6px;
        padding: 10px;
    }
    button {
        padding: 10px 20px;
        background: #0078ff;
        color: #fff;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        margin-top: 10px;
    }
    button:hover {
        background: #005fcc;
    }
    .msg {
        margin-bottom: 15px;
        padding: 10px;
        background: #e9f5ff;
        border-radius: 8px;
    }

    #voice-container {
        margin-top: 25px;
        padding: 20px;
        background: white;
        border-radius: 10px;
        border: 1px solid #ccc;
    }

</style>
</head>
<body>

<h2>‚öñÔ∏è Legal Aid Chat (Text + Voice Test)</h2>

<div id="chat-box">
    <div id="messages"></div>

    <textarea id="userInput" placeholder="Type your question..."></textarea>
    <button onclick="sendMessage()">Send</button>

    <hr>
    <h3>üé§ Voice Assistant</h3>
    <button onclick="startVoiceAssistant()">Start Voice Chat</button>
    <div id="voice-container"></div>
</div>

<script type="module">
    import { VoiceAssistant } from "https://unpkg.com/@livekit/agents-browser@latest/dist/index.js";

    window.startVoiceAssistant = async function () {
        console.log("üé§ Start button clicked!");

        const serverUrl = "wss://legal-aid-assistant-3k5z25gv.livekit.cloud";
        const token = "YOUR_NEW_AGENT_TOKEN_HERE";

        const container = document.getElementById("voice-container");
        container.innerHTML = "<p>üé§ Initializing voice assistant...</p>";

        try {
            const assistant = await VoiceAssistant.connect({
                url: serverUrl,
                token,
                autoStart: true,
                vad: true,
            });

            container.innerHTML = "";
            assistant.mount(container);

            console.log("Voice Assistant Ready!");

        } catch (err) {
            console.error("‚ùå Voice Assistant Error:", err);
            container.innerHTML = "<p style='color:red;'>Error starting voice assistant. Check console.</p>";
        }
    }
</script>


</body>
</html>
